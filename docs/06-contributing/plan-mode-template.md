# Plan 模式计划模板

> 本模板用于 Plan 模式输出结构化实施计划，确保关键信息完整且可执行。

## 1. 目标与范围

### 1.1 目标

简要描述本次改动的目标（1-2 句话）。

### 1.2 范围

**包含：**
- 列出本次改动包含的功能/模块

**不包含（非目标）：**
- 明确列出不在本次改动范围内的内容

### 1.3 背景

简要说明为什么需要这次改动，解决什么问题。

## 2. 改动清单

### 2.1 新增文件

| 文件路径 | 用途 | 预估行数 |
|---|---|---|
| `path/to/new_file.py` | 说明 | ~100 |

### 2.2 修改文件

| 文件路径 | 改动类型 | 改动说明 |
|---|---|---|
| `path/to/existing_file.py` | 新增函数 | 添加 `foo()` 函数 |
| `path/to/config.yaml` | 修改配置 | 新增 `bar` 配置项 |

### 2.3 删除文件

| 文件路径 | 删除原因 |
|---|---|
| `path/to/deprecated_file.py` | 功能已废弃 |

## 3. 接口/API 变更

### 3.1 新增接口

**端点：** `POST /api/v1/example`

**请求参数：**
```json
{
  "param1": "string",
  "param2": 123
}
```

**响应：**
```json
{
  "success": true,
  "data": {}
}
```

### 3.2 修改接口

**端点：** `GET /api/v1/existing`

**变更内容：**
- 新增可选参数 `filter`
- 响应增加 `metadata` 字段

**向后兼容性：** 是 / 否（如否，说明迁移策略）

### 3.3 废弃接口

**端点：** `DELETE /api/v1/deprecated`

**废弃原因：** 说明

**迁移路径：** 使用 `POST /api/v1/new` 替代

## 4. 配置变更

### 4.1 新增配置

| 配置项 | 类型 | 默认值 | 说明 |
|---|---|---|---|
| `NEW_CONFIG` | string | `""` | 说明 |

### 4.2 修改配置

| 配置项 | 旧默认值 | 新默认值 | 说明 |
|---|---|---|---|
| `EXISTING_CONFIG` | `false` | `true` | 说明 |

### 4.3 废弃配置

| 配置项 | 废弃原因 | 迁移路径 |
|---|---|---|
| `DEPRECATED_CONFIG` | 说明 | 使用 `NEW_CONFIG` 替代 |

## 5. 数据库变更

### 5.1 新增表

**表名：** `new_table`

**字段：**
```sql
CREATE TABLE new_table (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255) NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 修改表

**表名：** `existing_table`

**变更内容：**
- 新增字段 `new_column VARCHAR(255)`
- 修改字段 `old_column` 类型从 `INT` 到 `BIGINT`

**迁移脚本：** `migrations/001_add_new_column.sql`

### 5.3 数据迁移

**是否需要：** 是 / 否

**迁移策略：**
- 说明如何迁移现有数据
- 预估迁移时间与影响

## 6. 测试策略

### 6.1 单元测试

- [ ] 新增函数 `foo()` 的单元测试
- [ ] 修改函数 `bar()` 的单元测试

### 6.2 集成测试

- [ ] 新增接口 `/api/v1/example` 的集成测试
- [ ] 验证 fallback 逻辑

### 6.3 端到端测试

- [ ] 验证完整用户流程
- [ ] 验证错误处理

### 6.4 性能测试

- [ ] 验证新接口响应时间 < 500ms
- [ ] 验证并发 100 QPS 无错误

## 7. 验收标准

- [ ] 所有单元测试通过
- [ ] 所有集成测试通过
- [ ] API 文档已更新
- [ ] 配置文档已更新
- [ ] 代码评审通过
- [ ] 性能指标达标

## 8. 回滚方案

### 8.1 回滚触发条件

- 错误率 > 5%
- 响应时间 > 2s
- 关键功能不可用

### 8.2 回滚步骤

1. 关闭功能开关 `FEATURE_ENABLED=false`
2. 如需代码回滚，执行 `git revert <commit>`
3. 如有数据库变更，执行回滚脚本 `migrations/rollback_001.sql`
4. 验证回滚后系统正常

### 8.3 回滚影响

- 说明回滚后的影响范围
- 是否有数据丢失风险

## 9. 假设与依赖

### 9.1 假设

- 假设 1：上游服务 X 可用性 > 99.9%
- 假设 2：用户量不超过 10000

### 9.2 依赖

- 依赖 1：需要 DBA 创建数据库表
- 依赖 2：需要运维配置负载均衡

### 9.3 风险

- 风险 1：上游服务不稳定可能导致 fallback 频繁触发
- 风险 2：数据迁移时间可能超过预期

## 10. 实施计划

### 10.1 阶段划分

| 阶段 | 任务 | 预估时间 | 负责人 |
|---|---|---|---|
| 阶段 1 | 实现核心逻辑 | 2 天 | @developer |
| 阶段 2 | 编写测试 | 1 天 | @developer |
| 阶段 3 | 文档更新 | 0.5 天 | @developer |
| 阶段 4 | 代码评审 | 0.5 天 | @reviewer |

### 10.2 里程碑

- [ ] 2026-02-10：完成核心逻辑实现
- [ ] 2026-02-11：完成测试编写
- [ ] 2026-02-12：完成文档更新与代码评审
- [ ] 2026-02-13：合并到主分支

## 11. 相关文档

- [Plan 模式协作流程](./plan-mode-workflow.md)
- [代码规范](./code-style.md)
- [测试指南](./testing-guide.md)

---

**计划创建时间：** YYYY-MM-DD
**计划创建人：** @username
**评审人：** @reviewer1, @reviewer2
**批准状态：** 待评审 / 已批准 / 需修改
