# classPlatform Mini App äº§å“æŠ¥å‘Š

## ä¸€ã€äº§å“åŠŸèƒ½ä»‹ç»

### 1.1 äº§å“æ¦‚è¿°

**classPlatform** æ˜¯ä¸€æ¬¾åŸºäº React Native (Expo) å¼€å‘çš„è·¨å¹³å° AI æ™ºèƒ½è¾…å¯¼ Mini Appã€‚è¯¥åº”ç”¨ä¸“æ³¨äºä¸ºå­¦ç”Ÿæä¾›ä¸ªæ€§åŒ–çš„ç”µç£å­¦è¯¾ç¨‹å­¦ä¹ è¾…å¯¼ï¼Œæ”¯æŒ iOS å’Œ Android åŒå¹³å°è¿è¡Œã€‚

### 1.2 æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | æè¿° |
|---------|------|
| ğŸ” **ç”¨æˆ·ç™»å½•** | è´¦æˆ·è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒä¼šè¯æŒä¹…åŒ– |
| ğŸ’¬ **AI æ™ºèƒ½èŠå¤©** | ä¸‰ç§å¯¹è¯æ¨¡å¼ï¼šTutorï¼ˆå¯¼å¸ˆï¼‰ã€Solveï¼ˆè§£é¢˜ï¼‰ã€Simï¼ˆæ¨¡æ‹Ÿï¼‰ |
| ğŸ‘¤ **ä¸ªäººä¸­å¿ƒ** | æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯ã€ç®¡ç†æœ¬åœ°ç¼“å­˜ã€é€€å‡ºç™»å½• |
| ğŸ’¾ **æœ¬åœ°å­˜å‚¨** | èŠå¤©è®°å½•æœ¬åœ°ç¼“å­˜ï¼Œæ”¯æŒç¦»çº¿æŸ¥çœ‹ |

### 1.3 åŠŸèƒ½è¯¦æƒ…

#### 1.3.1 ç”¨æˆ·ç™»å½•
- æ”¯æŒç”¨æˆ·å/å¯†ç ç™»å½•
- ç™»å½•çŠ¶æ€æœ¬åœ°æŒä¹…åŒ–ï¼ˆAsyncStorageï¼‰
- è‡ªåŠ¨æ¢å¤ä¸Šæ¬¡ä¼šè¯

#### 1.3.2 AI æ™ºèƒ½èŠå¤©
- **Tutor æ¨¡å¼**ï¼šAI ä½œä¸ºå¯¼å¸ˆï¼Œå¼•å¯¼å¼æ•™å­¦
- **Solve æ¨¡å¼**ï¼šç›´æ¥è§£ç­”é—®é¢˜
- **Sim æ¨¡å¼**ï¼šæ¨¡æ‹Ÿå®éªŒè§£é‡Š

#### 1.3.3 ä¸ªäººä¸­å¿ƒ
- æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼ˆç”¨æˆ·åã€è§’è‰²ã€Token çŠ¶æ€ï¼‰
- æŸ¥çœ‹æœ¬åœ°ç¼“å­˜æ¶ˆæ¯æ•°é‡
- æ¸…é™¤èŠå¤©è®°å½•
- å®‰å…¨é€€å‡ºç™»å½•

---

## äºŒã€ç¨‹åºæ¦‚è¦è®¾è®¡

### 2.1 æ¨¡å—è®¾è®¡

```
mini-app-expo/
â”œâ”€â”€ App.tsx                 # ä¸»å…¥å£ï¼Œè·¯ç”±æ§åˆ¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api.ts              # ç½‘ç»œè¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ config.ts           # é…ç½®å¸¸é‡
â”‚   â”œâ”€â”€ storage.ts          # æœ¬åœ°å­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ types.ts            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ MessageBubble.tsx   # æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
â”‚   â””â”€â”€ screens/
â”‚       â”œâ”€â”€ LoginScreen.tsx     # ç™»å½•é¡µé¢
â”‚       â”œâ”€â”€ ChatScreen.tsx      # èŠå¤©é¡µé¢
â”‚       â””â”€â”€ ProfileScreen.tsx   # ä¸ªäººä¸­å¿ƒé¡µé¢
```

### 2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜

| æ¨¡å— | èŒè´£ |
|------|------|
| **App.tsx** | åº”ç”¨å…¥å£ï¼Œç®¡ç†å…¨å±€çŠ¶æ€ï¼ˆä¼šè¯ã€æ¶ˆæ¯ï¼‰ï¼Œåº•éƒ¨ Tab å¯¼èˆª |
| **api.ts** | å°è£… HTTP è¯·æ±‚ï¼Œå¤„ç†è¶…æ—¶ã€å–æ¶ˆã€é”™è¯¯é‡è¯• |
| **storage.ts** | AsyncStorage å°è£…ï¼Œç®¡ç†ä¼šè¯å’Œæ¶ˆæ¯æŒä¹…åŒ– |
| **ChatScreen.tsx** | èŠå¤©ç•Œé¢ï¼ŒFlatList æ¸²æŸ“æ¶ˆæ¯ï¼Œæ”¯æŒä¸‰ç§ AI æ¨¡å¼ |
| **LoginScreen.tsx** | ç™»å½•ç•Œé¢ï¼Œè¡¨å•éªŒè¯ï¼Œç™»å½•çŠ¶æ€ç®¡ç† |
| **ProfileScreen.tsx** | ä¸ªäººä¸­å¿ƒï¼Œè´¦æˆ·ä¿¡æ¯å±•ç¤ºï¼Œç¼“å­˜ç®¡ç† |

---

## ä¸‰ã€è½¯ä»¶æ¶æ„å›¾

### 3.1 æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯ (Expo React Native)"
        A[App.tsx<br/>ä¸»å…¥å£] --> B[LoginScreen<br/>ç™»å½•ç•Œé¢]
        A --> C[ChatScreen<br/>èŠå¤©ç•Œé¢]
        A --> D[ProfileScreen<br/>ä¸ªäººä¸­å¿ƒ]
        
        C --> E[api.ts<br/>ç½‘ç»œè¯·æ±‚]
        B --> E
        
        A --> F[storage.ts<br/>æœ¬åœ°å­˜å‚¨]
        C --> F
        B --> F
        D --> F
    end
    
    subgraph "åç«¯æœåŠ¡ (Go)"
        G[Auth API<br/>/api/v1/auth/login]
        H[AI Chat API<br/>/api/v1/ai/chat]
    end
    
    subgraph "å­˜å‚¨å±‚"
        I[(AsyncStorage<br/>æœ¬åœ°ç¼“å­˜)]
        J[(MySQL<br/>ç”¨æˆ·æ•°æ®)]
    end
    
    E -->|HTTP POST| G
    E -->|HTTP POST| H
    F -->|è¯»å†™| I
    G -->|æŸ¥è¯¢| J
```

### 3.2 æ•°æ®æµæ¶æ„

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant App as App.tsx
    participant Login as LoginScreen
    participant Chat as ChatScreen
    participant API as api.ts
    participant Storage as storage.ts
    participant Backend as Go Backend
    
    U->>Login: è¾“å…¥è´¦å·å¯†ç 
    Login->>API: login(username, password)
    API->>Backend: POST /api/v1/auth/login
    Backend-->>API: {access_token, user_info}
    API-->>Login: AuthSession
    Login->>Storage: saveAuthSession()
    Login-->>App: onLoginSuccess()
    
    U->>Chat: å‘é€æ¶ˆæ¯
    Chat->>API: chat(token, messages, mode)
    API->>Backend: POST /api/v1/ai/chat
    Backend-->>API: {reply}
    API-->>Chat: AI å›å¤
    Chat->>Storage: saveMessages()
```

---

## å››ã€æŠ€æœ¯äº®ç‚¹åŠå…¶å®ç°åŸç†

### 4.1 ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

#### è¯·æ±‚è¶…æ—¶ä¸å–æ¶ˆæœºåˆ¶

```typescript
// api.ts - è¯·æ±‚å°è£…æ ¸å¿ƒé€»è¾‘
async function request<T>(path: string, options: RequestInit = {}): Promise<T> {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), NETWORK_TIMEOUT_MS);
  
  // æ”¯æŒå¤–éƒ¨å–æ¶ˆä¿¡å·
  if (externalSignal?.aborted) {
    controller.abort();
  }
  
  try {
    const response = await fetch(buildUrl(path), {
      ...rest,
      signal: controller.signal,
    });
    // ...
  } finally {
    clearTimeout(timeoutId);
  }
}
```

**äº®ç‚¹**ï¼š
- ç»Ÿä¸€ 15 ç§’è¶…æ—¶æ§åˆ¶
- æ”¯æŒå¤–éƒ¨ AbortController å–æ¶ˆè¯·æ±‚
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆæœªå®Œæˆè¯·æ±‚

### 4.2 æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–

#### AsyncStorage å°è£…

```typescript
// storage.ts - æ¶ˆæ¯å­˜å‚¨
export async function saveMessages(messages: ChatMessage[]): Promise<void> {
  const trimmed = messages.slice(-MAX_HISTORY); // é™åˆ¶æœ€å¤š 50 æ¡
  await AsyncStorage.setItem(STORAGE_KEYS.messages, JSON.stringify(trimmed));
}
```

**äº®ç‚¹**ï¼š
- æ¶ˆæ¯æ•°é‡é™åˆ¶ï¼ˆMAX_HISTORY = 50ï¼‰ï¼Œé˜²æ­¢å­˜å‚¨è†¨èƒ€
- ä¼šè¯ä¸æ¶ˆæ¯åˆ†ç¦»å­˜å‚¨ï¼Œä¾¿äºç‹¬ç«‹ç®¡ç†
- åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤å†å²æ•°æ®

### 4.3 æ€§èƒ½ä¼˜åŒ–

#### FlatList è™šæ‹ŸåŒ–æ¸²æŸ“

```typescript
// ChatScreen.tsx
<FlatList
  ref={listRef}
  data={messages}
  keyExtractor={(item) => item.id}
  renderItem={({ item }) => <MessageBubble message={item} />}
  showsVerticalScrollIndicator={false}
/>
```

**æ€§èƒ½ä¿éšœ**ï¼š
- ä½¿ç”¨ FlatList æ›¿ä»£ ScrollViewï¼Œä»…æ¸²æŸ“å¯è§åŒºåŸŸ
- å”¯ä¸€ key æ ‡è¯†é¿å…ä¸å¿…è¦é‡æ¸²æŸ“
- æ¶ˆæ¯æ›´æ–°æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

#### ç«æ€æ¡ä»¶å¤„ç†

```typescript
// ChatScreen.tsx - é˜²æ­¢ç«æ€
const requestIdRef = useRef(0);
const mountedRef = useRef(true);

const handleSend = async () => {
  const requestId = requestIdRef.current + 1;
  requestIdRef.current = requestId;
  
  // å‘é€è¯·æ±‚...
  
  if (!mountedRef.current || requestId !== requestIdRef.current) {
    return; // å¿½ç•¥è¿‡æœŸå“åº”
  }
  // æ›´æ–°çŠ¶æ€...
};
```

**äº®ç‚¹**ï¼š
- requestId è¿½è¸ªç¡®ä¿åªå¤„ç†æœ€æ–°è¯·æ±‚çš„å“åº”
- mountedRef é˜²æ­¢ç»„ä»¶å¸è½½åæ›´æ–°çŠ¶æ€
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆè¿›è¡Œä¸­çš„è¯·æ±‚

### 4.4 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

| ä¼˜åŒ–ç‚¹ | å®ç°æ–¹å¼ |
|--------|----------|
| é”®ç›˜é€‚é… | KeyboardAvoidingView è‡ªåŠ¨è°ƒæ•´å¸ƒå±€ |
| åŠ è½½çŠ¶æ€ | ActivityIndicator + "AI is thinking..." æç¤º |
| é”™è¯¯å¤„ç† | å‹å¥½çš„é”™è¯¯æç¤ºæ¨ªå¹… |
| å¹³æ»‘äº¤äº’ | æŒ‰å‹åé¦ˆï¼ˆopacity å˜åŒ–ï¼‰ |

---

## äº”ã€æŠ€æœ¯æ ˆæ€»ç»“

| ç±»åˆ« | æŠ€æœ¯é€‰å‹ |
|------|----------|
| **æ¡†æ¶** | React Native (Expo 54) |
| **è¯­è¨€** | TypeScript |
| **çŠ¶æ€ç®¡ç†** | React Hooks (useState, useEffect, useRef) |
| **ç½‘ç»œè¯·æ±‚** | Fetch API + AbortController |
| **æœ¬åœ°å­˜å‚¨** | @react-native-async-storage/async-storage |
| **UI ç»„ä»¶** | React Native åŸç”Ÿç»„ä»¶ (FlatList, Pressable, etc.) |
| **åç«¯** | Go + Gin + MySQL |

---

## å…­ã€ä½œä¸šè¦æ±‚å¯¹ç…§

| è¦æ±‚é¡¹ | å®ç°æƒ…å†µ | è¯´æ˜ |
|--------|----------|------|
| âœ… åŠŸèƒ½è¦æ±‚ | å·²æ»¡è¶³ | AI æ™ºèƒ½èŠå¤©åŠŸèƒ½ï¼Œä¸‰ç§å¯¹è¯æ¨¡å¼ |
| âœ… æŠ€æœ¯è¦æ±‚ (ç½‘ç»œ) | å·²æ»¡è¶³ | HTTP API è°ƒç”¨ï¼ˆç™»å½•ã€èŠå¤©ï¼‰ |
| âœ… æŠ€æœ¯è¦æ±‚ (å­˜å‚¨) | å·²æ»¡è¶³ | AsyncStorage æœ¬åœ°æŒä¹…åŒ– |
| âœ… æ€§èƒ½è¦æ±‚ | å·²æ»¡è¶³ | FlatList è™šæ‹ŸåŒ–ã€è¯·æ±‚å–æ¶ˆã€å†…å­˜ç®¡ç† |

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2026-01-18*
